<!-- Hodgkin-Huxley方程式による定電流刺激のシミュレーション -->
<!--
copyright (c) 2020 Takayuki Yamamoto
Released under the MIT license.

Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the "Software"), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
-->
<!DOCTYPE html>
<html lang="ja">
<head>
	<meta charset="UTF-8">
<!--	<meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=yes"/>  -->
	<meta name="viewport" content="width=device-width">
	<title>Constant Current Stim.</title>
	<style type="text/css">
			body{background-color:#ccffff;}
	</style>
</head>
<body>
	
	<form name="form" onsubmit="return false">

	Graph size T <input type="number" id="idGraphWidth" min="200" max="1000" step="20" value="260" style="width:50px" 
	    onchange="draw_axis();"><label for="idGraphWidth">px: </label>
	I <input type="number" id="idi_Hight" min="50" max="200" step="10" 
		value="200" style="width:50px" onchange="draw_axis();"><label for="idi_Hight">px</label><br>

	<label><input type="checkbox" id="Checkbox1" checked="checked" onchange="draw_axis();">&mdash; V</label>
	<label><input type="checkbox" id="Checkbox3" onchange="draw_axis();"><span style="color: blue;">&mdash;  </span>G<sub>K</sub></label>
	<label><input type="checkbox" id="Checkbox2" onchange="draw_axis();"><span style="color: red;"> &mdash; </span>G<sub>Na</sub></label>
	 &nbsp;:<input type="number" id="idv_height" min="50" max="200" step="10" 
		value="200" style="width:50px" onchange="draw_axis();">px<br>
	<label><input type="checkbox" id="idchk_n" onchange="draw_axis();">
	<span style="color: blue;">&mdash; </span>n</label>
	<label><input type="checkbox" id="idchk_m" onchange="draw_axis();">
	<span style="color: red;">&mdash; </span>m</label>
	<label><input type="checkbox" id="idchk_h" onchange="draw_axis();">
		<span style="color: yellow;">&mdash; </span>h&nbsp;: </label>
	 <input type="number" id="idp_height" min="50" max="400" step="10" 
		value="200" style="width:50px" onchange="draw_axis();">px:
	<label><input type="checkbox" id="idchk_grid"  onchange="draw_axis();">Grid</label><br>

	<label><input type="checkbox" id="idchk_TEA" onchange="onChange_blocker()"><span style=color:red;>TEA</span></label>
	<input type="number" id="idTEAratio" min="0" max="100" step="1" style="width:40px" onchange="onChange_blocker()">%
	<label><input type="checkbox" id="idchk_TTX" onchange="onChange_blocker()"><span style="color: blue;">TTX </span></label>
	<input type="number" id="idTTXratio" min="0" max="100" step="1" style="width:40px" onchange="onChange_blocker()">%: 
	<label><input type="checkbox" id="idChk_textout">text out</label>
	</br>
		
	Time:
	  <input id="Radio5ms" name="RadioGroup1" type="radio" onchange="onRadioButtonChange();" value="5ms" />
        <label for="Radio5ms">5ms</label>
 	  <input id="Radio10ms" name="RadioGroup1" type="radio" onchange="onRadioButtonChange();" checked="checked" value="10ms" />
        <label for="Radio10ms" >10ms</label>
	  <input id="Radio20ms" name="RadioGroup1" type="radio" onchange="onRadioButtonChange();" value="20ms" />
	    <label for="Radio20ms">20ms</label>
	  <input id="Radio50ms" name="RadioGroup1" type="radio" onchange="onRadioButtonChange();" value="50ms" />
		<label for="Radio50ms">50ms</label><br>
	Stim.:<input id="idStimSingle" name="RadioGroup2" type="radio" onchange="onRadioButtonChange2();" checked="checked" value="Single" />
        <label for="StimSingle">Single</label>
 	  <input id="idStimDouble" name="RadioGroup2" type="radio" onchange="onRadioButtonChange2();" value="Double" />
		<label for="StimDouble" >Double</label>
	(Delay
	  <input type="number" id="idInterval" min="0" max="50.0" step="0.2"
		value="20" style="width:40px">ms)<br>
   Stim1:
      <input type="number" id="idCamplitude1" min="-40" max="100.0" step="0.2"
		value="10.0" style="width:50px" onchange="onChange_stim;"> &mu;A:
      <input type="number" id="idCduration1" min="0" max="50.0" step="0.2"
		value="1" style="width:40px" onchange="onChange_stim;"> ms <br>
    Stim2:
      <input type="number" id="idCamplitude2" min="-40" max="100" step="0.2"
		value="10.0" style="width:50px"onchange="onChange_stim;" >  
    &#956;A:
      <input type="number" id="idCduration2" min="0" max="50.0" step="0.2"
		value="1" style="width:40px" onchange="onChange_stim;"> ms <br>
	<input type="button" value="Simulate" onClick="simulation_start()">
	<input type="button" value=" CLS" onClick="draw_axis()">
	Temperature<input type="number" id="idTemperature" min="0" max="40" step=".2" style="width:40px">&nbsp;&deg;C
	<br>
	
	<canvas id="a_canvas" width="360" height="720"></canvas>
<!--**************************************************************** -->
<script type="text/javascript"><!--
	window.addEventListener('load',function(){
		load();
		draw_axis();
	});
	var Vrest=-60;
	var Sim_Width=260;
	var c_x0=50;
	var c_width = c_x0+Sim_Width+50;
	var Sim_Height=520;
	var c_y0=20;
	var c_y1=120;
	var c_y2=c_y0+c_y1-Vrest*(c_y1/80);
    var c_height = c_y0+ Sim_Height+70;	
	var i_Hight,i_Hight_data;
	var i_x0=c_x0;    //電流軸
	var i_y0=c_y0+230;//電流軸
	var i_y1=i_y0+150;//電流軸
	var p_height=200;		//位相面
	var p_y0=i_y1+p_height+70;	//位相面
	var v_height=210;
	var Vscale = v_height/7;//電位軸１目盛px
	var t_x0=c_x0;
	var t_y0=i_y1+30;
	var temp_data;
	var Camplitude1_data,Cduration1_data;
	var Camplitude2_data,Cduration2_data;
	var Interval_data;
	var Interval;
	var width,width_data;
	var TEAratio_data,TTXratio_data;
	var flag_draw_Gaxis=false;
	var flag_draw_pAxis=false;
	var tstop=8;
	var check1_data;
	var check2_data;
	var check3_data;
	var check_TEA_data,check_TEA,idCheck_TEA;
	var check_TTX_data,check_TTX,idCheck_TTX;
	var check7_data,check8_data;
	var chk_grid="false";
	var chk_textout="false";
	var chk_n_data="false"; 
	var chk_m_data="false"; 
	var chk_h_data="false";
	var chk_n="false"
	var chk_m="false"
	var chk_h="false"
	var data_2ms,data_5ms,data_10ms,data_20ms;
	var data_Single,data_Double,Stim_Num;
	var data_10uA,data_100uA,data_1000uA;
//canvas要素を取得
//	var canvas = document.getElementById("a_canvas");
	function $(id){ return document.getElementById(id);}
	var canvas = $('a_canvas'); //  
	var ctx = canvas.getContext('2d');	//描画用のコンテキストを取得
//


//**********************************************************************
//               読み込み
//**********************************************************************
function load(){
// 温度データ読み込み　--------------------------------------------------
	var n=localStorage.temp_data;
	if(isNaN(n)){
		n = parseFloat($('idTemperature').value)
	}	
	if(n){
		var temp=Number(n);
	}else{
		var temp=Math.round(Math.random()*(150-50+1)+50);
	}
	idTemperature.value=temp/10
	localStorage.temp_data=temp;
// グラフ幅読み込み　----------------------------------------------------
	n=localStorage.width_data;
	if(isNaN(n)){
		n = parseFloat($('idGraphWidth').value);
	}
	if(n){
		width=Number(n);
	}else{
		width=260;
	}
	idGraphWidth.value=width;
	localStorage.width_data=width;
// 電位軸高さ読み込み　----------------------------------------------------
	n=localStorage.v_height_data;
	if(isNaN(n)){
		n = parseFloat($('idv_height').value);
	}
	if(n){
		v_height=Number(n);
		if(v_height<80){v_height=80;}
		if(v_height>300){v_height=300;}
	}else{
		v_height=210;
	}
	Vscale=v_height/7;
	idv_height.value=v_height;
	localStorage.v_height_data=v_height;
// 電流軸高さ読み込み　----------------------------------------------------
	n=localStorage.i_Hight_data;
	if(isNaN(n)){
		n = parseFloat($('idi_Hight').value);
	}
	if(n){
		i_Hight=Number(n);
		if(i_Hight<80){i_Hight=80;}
		if(i_Hight>300){i_Hight=300;}
	}else{
		i_Hight=150;
	}
	idi_Hight.value=i_Hight;
	localStorage.i_Hight_data=i_Hight;
// n,m,h軸高さ読み込み　----------------------------------------------------
	n=localStorage.p_height_data;
	if(isNaN(n)){
		n = parseFloat($('idp_height').value);
	}
	if(n){
		p_height=Number(n);
	}else{
		p_height=200;
	}
	idp_height.value=p_height;
	localStorage.p_height_data=p_height;
// 定電流刺激強度1読み込み　------------------------------------------------
	n=localStorage.Camplitude1_data;
	if(isNaN(n)){
		n = parseFloat($('idCamplitude1').value)
	}
	if(n){
		var Camplitude1=Number(n);
	}else{
		var Camplitude1=10;
	}
	idCamplitude1.value=Camplitude1;
	localStorage.Camplitude1_data=Camplitude1;
// 定電流刺激幅1読み込み　-------------------------------------------------
	n=localStorage.Cduration1_data;
	if(isNaN(n)){
		n = parseFloat($('idCduration1').value)
	}

	if(n){
		var Cduration1=Number(n);
	}else{
		var Cduration1=1;
	}
	idCduration1.value=Cduration1;
	localStorage.Cduration1_data=Cduration1;
// 定電流刺激強度2読み込み　------------------------------------------------
	n=localStorage.Camplitude2_data;
	if(isNaN(n)){
		n = parseFloat($('idCamplitude2').value)
	}

	if(n){
		var Camplitude2=Number(n);
	}else{
		var Camplitude2=10;
	}
	idCamplitude2.value=Camplitude2;
	localStorage.Camplitude2_data=Camplitude2;
// 定電流刺激幅2読み込み　-------------------------------------------------
	n=localStorage.Cduration2_data;
	if(isNaN(n)){
		n = parseFloat($('idCduration2').value)
	}

	if(n){
		var Cduration2=Number(n);
	}else{
		var Cduration2=1;
	}
	idCduration2.value=Cduration2;
	localStorage.Cduration2_data=Cduration2;
// インターバル読み込み　---------------------------------------------------
	n=localStorage.Interval_data;
	if(isNaN(n)){
		n = parseFloat($('idInterval').value)
	}

	if(n){
		Interval=Number(n);
	}else{
		Interval=10;
	}
	idInterval.value=Interval;
	localStorage.Interval_data=Interval;
// チェックの読み込み -----------------------------------------------------
	n=localStorage.check1_data;
	if(n =="false"){$('Checkbox1').checked=false}
	if(n == "true"){$('Checkbox1').checked=true}
	var c=localStorage.check2_data;
	if(c =="false"){$('Checkbox2').checked=false}
	if(c == "true"){$('Checkbox2').checked=true}
	var c=localStorage.check3_data;
	if(c =="false"){$('Checkbox3').checked=false}
	if(c == "true"){$('Checkbox3').checked=true}
// 変数表示の読み込み-----------------------------------------------
	var c=localStorage.chk_n_data;
	if(c =="false"){$('idchk_n').checked=false}
	if(c =="true"){$('idchk_n').checked=true}
	var c=localStorage.chk_m_data;
	if(c =="false"){$('idchk_m').checked=false}
	if(c =="true"){$('idchk_m').checked=true}
	var c=localStorage.chk_h_data;
	if(c =="false"){$('idchk_h').checked=false}
	if(c =="true"){$('idchk_h').checked=true}
// TEA,TTX読み込み---------------------------------------------
	n=localStorage.TEAratio_data;
	if(isNaN(n)){
		n = parseFloat($('idTEAratio').value)
	}
	if(n){
		var TEAratio=Number(n);
	}else{
		var TEAratio=0;
	}
	idTEAratio.value=TEAratio;
	n=localStorage.TTXratio_data;
	if(isNaN(n)){
		n = parseFloat($('idTTXratio').value)
	}
	if(n){
		var TTXratio=Number(n);
	}else{
		var TTXratio=0;
	}
	idTTXratio.value=TTXratio;
	
	var c=localStorage.check_TEA_data;
	if(c =="false"){
		$('idchk_TEA').checked=false;
//		idTEAratio.value=0;
		idTEAratio.disabled=true;
	}
	if(c == "true"){
		$('idchk_TEA').checked=true;
		idTEAratio.disable=false;
		TEAratio=$('idTEAratio').value;
	}
	var c=localStorage.check_TTX_data;
	if(c =="false"){
		$('idchk_TTX').checked=false;
		idTTXratio.value=0;
		idTTXratio.disabled=true;
	}
	if(c == "true"){
		$('idchk_TTX').checked=true;
		idTTXratio.disabled=false;
		TTXratio=$('idTTXratio').value;
	}
	
	localStorage.TEAratio_data=idTEAratio.value;
	localStorage.TTXratio_data=idTTXratio.value;
//グリッド表示読み込み---------------------------------------
	var c=localStorage.check7_data;
	if(c =="false"){$('idchk_grid').checked=false}
	if(c == "true"){$('idchk_grid').checked=true}
//--------------------------------------------------------
	var c=localStorage.check8_data;
	if(c =="false"){$('idChk_textout').checked=false}
	if(c == "true"){$('idChk_textout').checked=true}	
//変数表示読み込み--------------------------------------------
	var c=localStorage.chk_n_data;
	if(c =="false"){$('idchk_n').checked=false}
	if(c == "true"){$('idchk_n').checked=true}
	var c=localStorage.chk_m_data;
	if(c =="false"){$('idchk_m').checked=false}
	if(c == "true"){$('idchk_m').checked=true}
	var c=localStorage.chk_h_data;
	if(c =="false"){$('idchk_h').checked=false}
	if(c == "true"){$('idchk_h').checked=true}
//時間軸読み込み--------------------------------------------
	var c5=localStorage.data_5ms;
	if(c5 =="true"){$('Radio5ms').checked=true}
	var c10=localStorage.data_10ms;
	if(c10 =="true"){$('Radio10ms').checked=true}
	var c20=localStorage.data_20ms;
	if(c20 =="true"){$('Radio20ms').checked=true}
	var c50=localStorage.data_50ms;
	if(c50 =="true"){$('Radio50ms').checked=true}
//電流軸読み込み---------------------------------------------
/**	var c=localStorage.data_10uA;
	if(c =="true"){$('Radio10uA').checked=true}
	var c=localStorage.data_100uA;
	if(c =="true"){$('Radio100uA').checked=true}
	var c=localStorage.data_1000uA;
	if(c =="true"){$('Radio1000uA').checked=true}
*/
//刺激回数読み込み-------------------------------------------
	var c1=localStorage.data_Single;
	if(c1 =="true"){
		$('idStimSingle').checked=true;
		idInterval.disabled=true;
		idCamplitude2.disabled=true;
		idCduration2.disabled=true;
		StimNum=1;
	}
	var c2=localStorage.data_Double;
	if(c2 =="true"){
		$('idStimDouble').checked=true;
		idInterval.disabled=false;
		idCamplitude2.disabled=false;
		idCduration2.disabled=false;
		StimNum=2;
	}
	
}
//*************************************************
//               時間軸変更
//*************************************************
function onRadioButtonChange(){
// 時間読み込み -----------------------
	var radiobtn5ms = $("Radio5ms");
	var radiobtn10ms = $("Radio10ms");
	var radiobtn20ms = $("Radio20ms");
	var radiobtn50ms = $("Radio50ms");
	data_5ms=radiobtn5ms.checked;
	data_10ms=radiobtn10ms.checked;
	data_20ms=radiobtn20ms.checked;
	data_50ms=radiobtn50ms.checked;
	if (radiobtn5ms.checked){tstop=5}
	if (radiobtn10ms.checked){tstop=10}
	if (radiobtn20ms.checked){tstop=20}
	if (radiobtn50ms.checked){tstop=50}
	localStorage.data_5ms=data_5ms;
	localStorage.data_10ms=data_10ms;
	localStorage.data_20ms=data_20ms;
	localStorage.data_50ms=data_50ms;
	
	draw_axis();
}
//*********************************************
//               電流軸変更
//*********************************************
function onRadioButtonChange3(){
// 電流軸読み込み -----------------------
/**	var radiobtn10uA = $("Radio10uA");
	var radiobtn100uA = $("Radio100uA");
	var radiobtn1000uA = $("Radio1000uA");
	data_10uA=radiobtn10uA.checked;
	data_100uA=radiobtn100uA.checked;
	data_1000uA=radiobtn1000uA.checked;
	if (radiobtn10uA.checked){
		stimCMax=10;
		stimCMin=-2;
	}
	if (radiobtn100uA.checked){
		stimCMax=100;
		stimCMin=-20;
	}
	if (radiobtn1000uA.checked){
		stimCMax=1000;
		stimCMin=-200;
	}
	localStorage.data_10uA=data_10uA;
	localStorage.data_100uA=data_100uA;
	localStorage.data_1000uA=data_1000uA;
	
	draw_axis();
*/
}
//******************************************
//               刺激回数変更
//******************************************
function onRadioButtonChange2(){
// 刺激回数読み込み -----------------------
	var StimSingle = $("idStimSingle");
	var StimDouble = $("idStimDouble");
	data_Single=StimSingle.checked;
	data_Double=StimDouble.checked;
	if (StimSingle.checked){
		Stim_Num=1;
		idInterval.disabled=true;
		idCamplitude2.disabled=true;
		idCduration2.disabled=true;
	}
	if (StimDouble.checked){
		Stim_Num=2;
		idInterval.disabled=false;
		idCamplitude2.disabled=false;
		idCduration2.disabled=false;
	}
	localStorage.data_Single=data_Single;
	localStorage.data_Double=data_Double;
}
//*****************************************************
//               刺激入力チェック
//*****************************************************
function onChange_stim(){
	if(idCamplitude1.value>2000){idCamplitude1.value=2000}
	if(idCamplitude1.value<-40){idCamplitude1.value=-40}
	if(idCamplitude2.value>2000){idCamplitude2.value=2000}
	if(idCamplitude2.value<-40){idCamplitude2.value=-40}
	if(idCduration1.value<0){idCduration1.value=0}
	if(idCduration1.value>50){idCduration1.value=50}
	if(idCduration2.value<0){idCduration2.value=0}
	if(idCduration2.value>50){idCduration2.value=50}
}
//****************************************************
//               TEA/TTXチェック
//****************************************************
function onChange_blocker(){
	if(idTEAratio.value>100){idTEAratio.value=100}
	if(idTTXratio.value>100){idTTXratio.value=100}
	if(idTEAratio.value<0){idTEAratio.value=0}
	if(idTTXratio.value<0){idTTXratio.value=0}
	if($('idchk_TEA').checked==true){
		$('idTEAratio').disabled=false;
	}
	else{
		// idTEAratio.value=0;
		idTEAratio.disabled=true;
	}
	if($('idchk_TTX').checked==true){
		$('idTTXratio').disabled=false;
	}
	else{
		// idTTXratio.value=0;
		$('idTTXratio').disabled=true;
	}
	localStorage.TEAratio_data=idTEAratio.value;
	localStorage.TTXratio_data=idTTXratio.value;
}
//***************************************************
//               画面クリア
//***************************************************
function draw_cls(){
	flag_draw_Gaxis=false;
	flag_draw_pAxis=false;
	draw_axis();
}
//****************************************************
//               軸描画
//***************************************************
function draw_axis(){
// グラフ幅読み込み -------------------------
	Sim_Width = parseFloat($('idGraphWidth').value);	//グラフ幅(px)
	if(Sim_Width>2000){Sim_Width=2000}
	if(Sim_Width<100){Sim_Width=100}
	c_width = c_x0+Sim_Width+50;
// 電流軸高さ読み込み　------------------------
	i_Hight = parseFloat($('idi_Hight').value);
	if(i_Hight>300){i_Hight=300}
	if(i_Hight<80){i_Hight=80}
	idi_Hight.value=i_Hight;

	canvas.setAttribute('width',c_width);
	canvas.setAttribute('hight',c_width);
	localStorage.width_data=Sim_Width;
	localStorage.i_Hight_data=i_Hight;
// 電位軸読み込み　----------------------------
	v_height = parseFloat($('idv_height').value);
	if(v_height>300){v_height=300}
	if(v_height<50){v_height=50}
	idv_height.value=v_height;
	Vscale=v_height/7;
	localStorage.v_height_data=v_height;
// n,m,h軸読み込み　----------------------------
	p_height = parseFloat($('idp_height').value);
	if(p_height>200){p_height=200}
	if(p_height<50){p_height=50}
	idp_height.value=p_height;
	localStorage.p_height_data=p_height;
		
// 時間読み込み -----------------------
	var radiobtn5ms = $("Radio5ms");
   	var radiobtn10ms = $("Radio10ms");
   	var radiobtn20ms = $("Radio20ms");
	var radiobtn50ms = $("Radio50ms");
	data_5ms=radiobtn5ms.checked;
	data_10ms=radiobtn10ms.checked;
	data_20ms=radiobtn20ms.checked;
	data_50ms=radiobtn50ms.checked;
	if (radiobtn5ms.checked){tstop=5}
	if (radiobtn10ms.checked){tstop=10}
	if (radiobtn20ms.checked){tstop=20}
	if (radiobtn50ms.checked){tstop=50}
	localStorage.data_5ms=data_5ms;
	localStorage.data_10ms=data_10ms;
	localStorage.data_20ms=data_20ms;
	localStorage.data_50ms=data_50ms;
// 変数表示読み込み　--------------------
	if(idchk_n.checked){chk_n=true;}else{chk_n=false}
	if(idchk_m.checked){chk_m=true;}else{chk_m=false}
	if(idchk_h.checked){chk_h=true;}else{chk_h=false}
// グリッド表示読み込み　--------------------
	if(idchk_grid.checked){chk_grid=true;}
	else{chk_grid=false}

// 四角-------------------------------
	ctx.fillStyle="#FFFFFF";
	i_y0=c_y0+Vscale*7+20;
//	i_y1=c_y0+Vscale*7+20;
	if(chk_n==true || chk_m==true || chk_h==true){
//		p_y0=c_y0+Vscale*7+20+i_Hight+p_height+70;
		p_y0=c_y0+Vscale*7+20+p_height;
		i_y0=p_y0+20;
		ctx.fillRect(c_x0,p_y0,Sim_Width,-p_height);
	}
	
	i_y2=i_y1+i_Hight;
	c_hight=i_y2+50;
	ctx.fillRect(c_x0,c_y0,Sim_Width,Vscale*7);
	ctx.fillRect(c_x0,i_y0,Sim_Width,i_Hight);
	ctx.fillStyle="black";

//電位軸-----------------------
	if(Checkbox1.checked){
		draw_Vaxis();
	}
	
//コンダクタンス軸------------------------------------------
	if((Checkbox2.checked)||(Checkbox3.checked)){
		draw_Gaxis();
	}
//-------------------------------------------------------
//電流軸
	i_y1=i_y0+i_Hight;
	ctx.beginPath();
	ctx.moveTo(c_x0,i_y0); //Y軸　+100μA
	ctx.lineTo(c_x0,i_y1);　//Y軸　-20μA
	for(i=0;i<13;i++){
		y=(i_y1-i_y0)/12*i+i_y0;
		ctx.moveTo(c_x0,y);
		ctx.lineTo(c_x0+5,y);
	}
	ctx.stroke();
	ctx.font="11pt bold";
	y_scale=(i_y1-i_y0)/12;
	ctx.fillText("-20",22,i_y0+y_scale*12+6);
	ctx.fillText(" 0",30,i_y0+y_scale*10+6);
	ctx.fillText(" 20",22,i_y0+y_scale*8+6);
	ctx.fillText(" 40",22,i_y0+y_scale*6+6);
	ctx.fillText(" 60",22,i_y0+y_scale*4+6);
	ctx.fillText(" 80",22,i_y0+y_scale*2+6);
	ctx.fillText(" 100",12,i_y0+6);

	ctx.beginPath();
	ctx.font = "14pt bold" ;
	ctx.textAlign = 'center';
	ctx.save();
	ctx.rotate(-90*Math.PI/180);
//	ctx.fillText("I (μA)",-((i_y0+i_Hight+14)-(i_Hight-80)*0.5),14);
	ctx.fillText("I (μA)",-(i_y0+i_Hight*0.5),14);
	ctx.restore();
	ctx.textAlign = 'left';

//----------------------------------------------------------------------
// 時間軸
	t_y0=i_y1;
	ctx.moveTo(c_x0+Sim_Width/11,t_y0);
	ctx.lineTo(c_x0+Sim_Width,t_y0);			//時間軸
	for(i=1;i<12;i++){
		ctx.moveTo(c_x0+Sim_Width/11*i,t_y0);		//時間軸目盛
		ctx.lineTo(c_x0+Sim_Width/11*i,t_y0-5);
	}
	ctx.stroke();
	ctx.font = "11pt bold" ;				//時間軸ラベル
	ctx.fillText("0",c_x0+Sim_Width/11-4,t_y0+20);           //時間軸ラベル
	ctx.fillText(tstop/2,c_x0+Sim_Width*6/11-10,t_y0+20);	//時間軸ラベル
	ctx.fillText(tstop,c_x0+Sim_Width-10,t_y0+20);  		//時間軸ラベル
	ctx.font = "14pt bold";
	ctx.textAlign = 'center';
	ctx.fillText("Time(ms)",c_x0+Sim_Width*.5,t_y0+36);
	ctx.textAlign = 'left';
//---------------------------------------------------------------------
//　変数軸
	if(chk_n==true || chk_m==true || chk_h==true){
		ctx.moveTo(c_x0,p_y0);
		ctx.lineTo(c_x0,p_y0-p_height);
		for (i=0; i<6;i++){
			ctx.moveTo(c_x0,p_y0-p_height/5*i);
			ctx.lineTo(c_x0+5,p_y0-p_height/5*i);
		}
		ctx.moveTo(c_x0+Sim_Width,p_y0);
		ctx.lineTo(c_x0+Sim_Width,p_y0-p_height);
		for (i=0; i<6;i++){
			ctx.moveTo(c_x0+Sim_Width,p_y0-p_height/5*i);
			ctx.lineTo(c_x0+Sim_Width-5,p_y0-p_height/5*i);
		}
		ctx.stroke();
		ctx.font="11pt bold";
		for(i=0; i<6; i++){
			ctx.fillText(String(Math.round((0.0+0.2*i)*10)/10),c_x0-28,p_y0-p_height/5*i+5);
		}
		for(i=0; i<6; i++){
			ctx.fillText(String(Math.round((0.0+0.2*(5-i))*10)/10),c_x0+Sim_Width+5,p_y0-p_height/5*i+5);
		}
		ctx.font = "14pt bold";
		ctx.save();
		ctx.rotate(-90*Math.PI/180);
		ctx.textAlign = 'center';
		ctx.fillText("n,m",-(p_y0-p_height*.5),14);
		//ctx.fillText("K,Na");
		ctx.fillText("h",-(p_y0-p_height*.5),c_x0+Sim_Width+45);
		ctx.restore();
		ctx.textAlign = 'left';
	}
	//グリッド----------------------------------------------------------
		if (chk_grid == true){
			draw_Grid();
		}
//++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
}
//*******************************************
//               グリッド描画
//*******************************************
function draw_Grid(){
//	電位軸------------------------------------
	ctx.beginPath();
	ctx.lineWidth=0.3;
	var c_div=v_height/8;
	for(i=0;i<9;i++){
		ctx.moveTo(c_x0,c_y0+c_div*i);
		ctx.lineTo(c_x0+Sim_Width,c_y0+c_div*i); //横軸
	}
	ctx.stroke();
// 時間軸（電圧）
	y1=c_y0;
	y2=c_y0+v_height;
	for(i=0;i<12;i++){
		x=c_x0+Sim_Width/11*i;
		ctx.moveTo(x,y1);
		ctx.lineTo(x,y2);
	}
	/*
	for(i=0;i<10;i++){
		ctx.moveTo(c_x0+Sim_Width/9*i,c_y0);
		ctx.lineTo(c_x0+Sim_Width/9*i,c_y0+v_height); //縦軸		
	}
	*/
	ctx.stroke();
//　電流軸---------------------------------
	ctx.beginPath();
	ctx.lineWidth=0.3;
	x1=c_x0;
	x2=c_x0+Sim_Width;
	for(i=0;i<13;i++){
		y=(i_y1-i_y0)/12*i+i_y0;
		ctx.moveTo(x1,y);
		ctx.lineTo(x2,y);
	}
	ctx.stroke();
// 時間軸（電流）
	y1=i_y0;
	y2=i_y1;
	for(i=0;i<12;i++){
		x=c_x0+Sim_Width/11*i;
		ctx.moveTo(x,y1);
		ctx.lineTo(x,y2);
	}
	ctx.stroke();
//変数表示----------------------------------------------
	if(chk_n==true || chk_m==true || chk_h==true){
		ctx.lineWidth=0.3
		// 時間軸（チャネル変数）
		y1=p_y0;
		y2=p_y0-p_height;
		for(i=0;i<12;i++){
			x=c_x0+Sim_Width/11*i;
			ctx.moveTo(x,y1);
			ctx.lineTo(x,y2);
		}
		//　変数軸
		x1=c_x0;
		x2=c_x0+Sim_Width;
		for(i=0;i<11;i++){
			y=p_y0-p_height/10*i;
			ctx.moveTo(x1,y);
			ctx.lineTo(x2,y);
		}
		ctx.stroke();
	}	
	
}
//************************************************
//               電圧軸描画
//************************************************
function draw_Vaxis(){
//電位軸-----------------------
	c_y1=v_height/2;
	ctx.beginPath();
	ctx.moveTo(c_x0,c_y0);//Y軸 +80mV
	ctx.lineTo(c_x0,c_y0+v_height);//Y軸　～-80mV
	for(i=0;i<9;i++){
		ctx.moveTo(c_x0,c_y0+v_height/8*i);
		ctx.lineTo(c_x0+5,c_y0+v_height/8*i);
	}
	ctx.stroke();
	ctx.font="11pt bold";
	ctx.fillText("80",20,c_y0+6);
	ctx.fillText("40",20,c_y0+v_height/8*2+6);
	ctx.fillText(" 0",20,c_y0+v_height/8*4+6);
	ctx.fillText("-40",20,c_y0+v_height/8*6+6);
	ctx.fillText("-80",20,c_y0+v_height+6);

	ctx.beginPath();
	ctx.font = "14pt bold" ;
	ctx.save();
	ctx.rotate(-90*Math.PI/180);
	ctx.textAlign = 'center';
	ctx.fillText("V(mV)",-(c_y0+v_height/2),20);
	ctx.restore();
	ctx.textAlign= 'left';
}
//***********************************************
//               コンダクタンス軸描画
//***********************************************
function draw_Gaxis(){
// コンダクタンス軸表示
	if(Checkbox1.checked){
		var x1=c_x0+Sim_Width;
		var x2=c_x0+Sim_Width+7;
		var x3=c_x0+Sim_Width+45;
		var x4=-5;
	}else{
		var x1=c_x0;
		var x4=+5;
		var x2=25;
		var x3=20;
	}
	var c_div=v_height/8;
//	c_y2=c_y0+c_y1-(-60)*(c_y1/80); //-60mV=0mS
	c_y2=c_y0+c_div*7;
	ctx.beginPath();
	ctx.strokeStyle = "black";
	ctx.lineWidth=1;
	ctx.moveTo(x1,c_y0);//コンダクタンスY軸
	ctx.lineTo(x1,c_y2);
	for(i=-0;i<8;i++){
		ctx.moveTo(x1+x4,c_y2-i*c_div);//コンダクタンスY軸目盛
		ctx.lineTo(x1,c_y2-i*c_div);
	}
	ctx.stroke();
	ctx.font="11pt bold";
	ctx.fillText("0",x2,c_y2+6);//コンダクタンスY軸ラベル
	ctx.fillText("10",x2,c_y2-c_div+6);//コンダクタンスY軸ラベル
	ctx.fillText("20",x2,c_y2-c_div*2+6);//コンダクタンスY軸ラベル
	ctx.fillText("30",x2,c_y2-c_div*3+6);//コンダクタンスY軸ラベル
	ctx.fillText("40",x2,c_y2-c_div*4+6);//コンダクタンスY軸ラベル
	ctx.fillText("50",x2,c_y2-c_div*5+6);//コンダクタンスY軸ラベル
	ctx.fillText("60",x2,c_y2-c_div*6+6);//コンダクタンスY軸ラベル
	ctx.fillText("70",x2,c_y2-c_div*7+6);//コンダクタンスY軸ラベル

	ctx.beginPath();
	ctx.textAlign = 'center';
	ctx.font = "14pt bold" ;
	ctx.save();
	ctx.rotate(-90*Math.PI/180);
	ctx.fillText("G (mS)",-(c_y0+c_div*3),x3);
	ctx.restore();
	ctx.textAlign= 'left';
	flag_draw_Gaxis=true;
}
//*****************************************************
//               シミュレーション実行
//*****************************************************
function simulation_start1(){
	draw_cls();
	simulation_start();
}
//-----------------------------------------------------
function simulation_start(){
//初期設定
	var	i,j,t;
	var	dt = 0.0025;				//単位時間（mS）dt=0.0025
	var Camplitude1 = parseFloat($('idCamplitude1').value);	//刺激強度1(mV)
		localStorage.Camplitude1_data=Camplitude1;
	var Cduration1 = parseFloat($('idCduration1').value); //持続時間1(mS)
		localStorage.Cduration1_data=Cduration1;
	var Camplitude2 = parseFloat($('idCamplitude2').value);	//刺激強度2(mV)
		localStorage.Camplitude2_data=Camplitude2;
	var Cduration2 = parseFloat($('idCduration2').value); //持続時間2(mS)
		localStorage.Cduration2_data=Cduration2;
		Interval=parseFloat($('idInterval').value); //インターバル
		localStorage.Interval_data=Interval;
//	var sduration = parseFloat($('idSduration').value);	//持続時間(mS)
//	var sduration = 16;
	var chk_V = document.form.Checkbox1.checked;
		localStorage.check1_data=chk_V;
	var chk_GNa = document.form.Checkbox2.checked;
		localStorage.check2_data=chk_GNa;
	var chk_GK = document.form.Checkbox3.checked;
		localStorage.check3_data=chk_GK;
		check_TEA = document.form.idchk_TEA.checked;
		localStorage.check_TEA_data=check_TEA;
		check_TTX = document.form.idchk_TTX.checked;
		localStorage.check_TTX_data=check_TTX;
//---------------------------------------------
	var Gna0bairitu = 1; //Gna0の倍率-----------------
	var Gk0bairitu = 1; //Gk0の倍率-------------------
	if (idTEAratio.value>100){idTEAratio=100}
	if (idTEAratio.value<0){idTEAratio=0}
	if (idTTXratio.value>100){idTTXratio.value=100}
	if (idTTXratio.value<0){idTTXratio.value=0}
	if  (check_TEA == true){Gk0bairitu =(100-idTEAratio.value)/100}
	if  (check_TTX == true){Gna0bairitu =(100-idTTXratio.value)/100}
//	var check6 = document.form.Checkbox6.checked;
	var chk_grid = document.form.idchk_grid.checked;
		localStorage.check7_data=chk_grid;
	var chk_textout = document.form.idChk_textout.checked;
		localStorage.check8_data=chk_textout;

//---------------------------------------------------------
	var chk_n = document.form.idchk_n.checked;
		localStorage.chk_n_data=chk_n;
	var chk_m = document.form.idchk_m.checked;
		localStorage.chk_m_data=chk_m;
	var chk_h = document.form.idchk_h.checked;
		localStorage.chk_h_data=chk_h;
//------------------------------------------------------
	onRadioButtonChange2();
	var Cm = 1.0;					//膜容量(F)
	var Vrest = -60.0;			//静止電位(mV)
	var Ek=-12.0+Vrest,Ena=115.0+Vrest,El=10.6+Vrest;
	var Gl0=0.3;//最大コンダクタンス(mS/cm2)　Gk0=36.0,Gna0=120.0
	var Gk0=36.0*Gk0bairitu;//------------------------
	var Gna0=120.0*Gna0bairitu;//----------------------
	var Gk,Gna,Gl;
	var temp = parseInt($('idTemperature').value*10); //温度（℃）
		if(temp <0){temp=0}
		if(temp>300){temp=300}
		celsius=temp/10;
		idTemperature.value=celsius;
		localStorage.temp_data=temp;
	var phi=Math.pow(3,(celsius-6.3)/10);
	var Vm,newVm;
	var Ik,Ina,Il;
	var Im,Ichannel,Istim;
	var Am,Bm,An,Bn,Ah,Bh;
	var m,n,h;
	var V =	new Array();
	var S =	new Array();
	var Gmna =	new Array();
	var Gmk	 =	new Array();
	var I_k	= new Array();
	var I_na =	new Array();
	var I_m	= new Array();
	var n1 = new Array();
	var m1 = new Array();
	var h1 = new Array();
	var x1,y1,x2,y2,Vm_y1,Vm_y2,Gna_y1,Gk_y1;
//	var t_x0,t_y0,i_x0,i_y0,i_y1;
	onChange_stim();
//------------------------------------------------------
	Vm=0.0;
	V[0]=Vm;
	I_m[0]=0;I_k[0]=0;I_na[0]=0;Gmk[0]=0;Gmna[0]=0;
	An=phi*0.01*(10.0-Vm)/(Math.exp((10.0-Vm)/10.0)-1.0);
	Bn=phi*0.125*Math.exp(-Vm/80.0);
	Am=phi*0.1*(25.0-Vm)/(Math.exp((25.0-Vm)/10.0)-1.0);
	Bm=phi*4.0*Math.exp(-Vm/18.0);
	Ah=phi*0.07*Math.exp(-Vm/20.0);
	Bh=phi*1.0/(Math.exp((30.0-Vm)/10.0)+1.0);

	n=An/(An+Bn);
	m=Am/(Am+Bm);
	h=Ah/(Ah+Bh);
	n1[0]=n;
	m1[0]=m;
	h1[0]=h;
//-------------------------------------------------------	
	t=0.0;
	for(i=1;i<tstop/dt+1;i++){
		if(i<Cduration1/dt){
			I_m[i]=Camplitude1;
		}
		else{
			I_m[i]=0;
		}
	}
	if (Stim_Num==2){
		for(i=Math.round(Interval/dt+1);i<Math.round((Interval+Cduration2)/dt);i++){
			if(tstop/dt>=i){I_m[i]=Camplitude2}
		}
	}
//------------------------------------------------------------
	t=0.0;
	for (i=1;i<tstop/dt+1;i++){
//		if (t<Cduration1){
//			Istim=Camplitude1;
//		}
//		else{
//			Istim=0.0;
//		}
		Istim=I_m[i];
		V[i]=Vm;
		if(Vm==10.0){
			An=phi*0.1;
		}
		else{
			An=phi*0.01*(10.0-Vm)/(Math.exp((10.0-Vm)/10.0)-1.0);
		}
		Bn=phi*0.125*Math.exp(-Vm/80.0);
		if(Vm==25.0){
			Am=phi*1.0;
		}
		else{
			Am=phi*0.1*(25.0-Vm)/(Math.exp((25.0-Vm)/10.0)-1.0);
		}
		Bm=phi*4.0*Math.exp(-Vm/18.0);
		Ah=phi*0.07*Math.exp(-Vm/20.0);
		Bh=phi*1.0/(Math.exp((30.0-Vm)/10.0)+1.0);

		n=(n+(An*(1.0-n)-Bn*n)*dt);
		m=(m+(Am*(1.0-m)-Bm*m)*dt);
		h=(h+(Ah*(1.0-h)-Bh*h)*dt);

		Gk=Gk0*n*n*n*n;
		Gna=Gna0*m*m*m*h;
		Gl=Gl0;

		Ik=Gk*(Vm+Vrest-Ek);
		Ina=Gna*(Vm+Vrest-Ena);
		Il=Gl*(Vm+Vrest-El);
		Ichannel=Ik+Ina+Il;

		Im=Istim-Ichannel;
		newVm=Vm+(Im/Cm)*dt;

		Vm=newVm;
		V[i]=Vm;
		Gmna[i]=Gna;
		Gmk[i]=Gk;
		I_k[i]=Ik;
		I_na[i]=Ina;
//		I_m[i]=Ichannel/1000;  //mA
//		I_m[i]=Istim;
		n1[i]=n;
		m1[i]=m;
		h1[i]=h;
		t=t+dt;
    }
//+++++++++++++++++++++++++++++++++++++++++++++++++
//                   CANVASに描画
//+++++++++++++++++++++++++++++++++++++++++++++++++
	var g1=v_height/80;	
//-------------------------------------------------
// ナトリウムコンダクタンスのトレース
	if (chk_GNa == true){
	ctx.beginPath();
	ctx.strokeStyle = "red";
	ctx.lineWidth=1;
	x2=c_x0;
	x1=c_x0+Sim_Width/11;
	ctx.moveTo(x2,c_y2-Gmna[0]*g1);  // c_y2-Gmna*3
	ctx.lineTo(x1,c_y2-Gmna[0]*g1);
	for(i=1;i<(tstop/dt+1);i++){
		ctx.lineWidth=2;
		x2=x1+i/(tstop/dt)*Sim_Width*10/11;
		ctx.lineTo(x2,c_y2-Gmna[i]*g1);	//
	}
	ctx.stroke();
	}
//----------------------------------------------------------
// カリウムコンダクタンスのトレース
	if (chk_GK == true){
	ctx.beginPath();
	ctx.strokeStyle = "blue";
	x2=c_x0;
	x1=c_x0+Sim_Width/11;
	ctx.moveTo(x2,c_y2-Gmk[0]*g1);  // c_y2-Gmna*3
	ctx.lineTo(x1,c_y2-Gmk[0]*g1);
	for(i=1;i<(tstop/dt+1);i++){
		ctx.lineWidth=2;
		x2=x1+i/(tstop/dt)*Sim_Width*10/11;
		ctx.lineTo(x2,c_y2-Gmk[i]*g1);	//
	}
/*
	ctx.moveTo(c_x0,c_y2-Gmk[0]*g1);
	ctx.lineTo(c_x0+Sim_Width/9,c_y2-Gmk[0]*g1);
	for(i=1;i<(tstop/dt+1);i++){
		ctx.lineWidth=2;
		ctx.lineTo(c_x0+Sim_Width/9+i/(tstop/dt)*Sim_Width*8/9,c_y2-Gmk[i]*g1);	//
	}
*/
/*	draw_Gaxis();
	ctx.beginPath();
	ctx.strokeStyle = "blue";
	x1=c_x0;
	x2=c_x0+Sim_Width/11;
	y=c_y2-Gmk[0]*Vscale/10*1-Vscale;
	ctx.moveTo(x1,y);
	ctx.lineTo(x2,y);
	for(i=1;i<(tstop/dt+1);i++){
		ctx.lineWidth=2;
		x=c_x0+Sim_Width/11+i/(tstop/dt)*Sim_Width*10/11;
		y=c_y2-Gmk[i]*Vscale/10*1-Vscale;
		ctx.lineTo(x,y);	//
	}
*/
	ctx.stroke();
	}
//--------------------------------------------------------------------
// 電位のトレース
	if(chk_V == true){
	ctx.beginPath();
	ctx.strokeStyle = "black";
	ctx.lineWidth=2;
	x1=c_x0;
	x2=c_x0+Sim_Width/11;
	//y=(c_y0+Vscale*3)-(Vrest+V[0])*(Vscale/20); //-80mV～+60mV 20mV=Vscale
	y=(c_y0+v_height-(Vrest+V[0]+80)*v_height/160); //-80mV～+80mV = 160 mV
	ctx.moveTo(x1,y);
	ctx.lineTo(x2,y);
	for(i=1;i<(tstop/dt+1);i++){
		x=c_x0+i/(tstop/dt)*Sim_Width*10/11+Sim_Width/11;
		// y=(c_y0+Vscale*3)-(Vrest+V[i])*(Vscale/20);
		y=(c_y0+v_height-(Vrest+V[i]+80)*v_height/160);
		ctx.lineTo(x,y);//電位のトレース
	}
	ctx.stroke();
	}
//------------------------------------------------------------
// 膜電流のトレース
	ctx.beginPath();
	ctx.strokeStyle = "black";
	ctx.lineWidth=2;
	x1=c_x0;
	x2=c_x0+Sim_Width/11;
	y=i_y1-(i_y1-i_y0)/(100-(-20))*20; //0μA
	ctx.moveTo(x1,y);
	ctx.lineTo(x2,y);
	for(i=1;i<(tstop/dt+1);i++){
		x=c_x0+i/(tstop/dt)*Sim_Width*10/11+Sim_Width/11;
		y=i_y1-(i_y1-i_y0)/(100-(-20))*20-I_m[i]*(i_y1-i_y0)/(100-(-20));
		if(y<i_y0){
			y=i_y0;
		}
		ctx.lineTo(x,y);//膜電流のトレース
	}
	ctx.stroke();
	ctx.strokeStyle ="black";
//-------------------------------------------------------------
//変数のトレース
	// nのトレース　------------------------------------------------------
	if(chk_n==true){
	ctx.beginPath();
	ctx.strokeStyle = "blue";
	ctx.lineWidth=2;
	x1=c_x0;
	x2=c_x0+Sim_Width/11;
	y=(p_y0-n1[0]*p_height); 
	ctx.moveTo(x1,y);
	ctx.lineTo(x2,y);
	for(i=1;i<(tstop/dt+1);i++){
		x=c_x0+i/(tstop/dt)*Sim_Width*10/11+Sim_Width/11;
		y=(p_y0-n1[i]*p_height);
		ctx.lineTo(x,y);//nのトレース
	}
	ctx.stroke();
	ctx.strokeStyle ="black";
	}
// hのトレース　----------------------------------------------------------
	if(chk_h==true){
	ctx.beginPath();
	ctx.strokeStyle = "darkorange";
	ctx.lineWidth=2;
	x1=c_x0;
	x2=c_x0+Sim_Width/11;
	y=(p_y0-(1-h1[0])*p_height); 
	ctx.moveTo(x1,y);
	ctx.lineTo(x2,y);
	for(i=1;i<(tstop/dt+1);i++){
		x=c_x0+i/(tstop/dt)*Sim_Width*10/11+Sim_Width/11;
		y=(p_y0-(1-h1[i])*p_height);
		ctx.lineTo(x,y);//hのトレース
	}
	ctx.stroke();
	ctx.strokeStyle ="black";
	}
// mのトレース　----------------------------------------------------------
	if(chk_m==true){
	ctx.beginPath();
	ctx.strokeStyle = "red";
	ctx.lineWidth=2;
	x1=c_x0;
	x2=c_x0+Sim_Width/11;
	y=(p_y0-m1[0]*p_height); 
	ctx.moveTo(x1,y);
	ctx.lineTo(x2,y);
	for(i=1;i<(tstop/dt+1);i++){
		x=c_x0+i/(tstop/dt)*Sim_Width*10/11+Sim_Width/11;
		y=(p_y0-m1[i]*p_height);
		ctx.lineTo(x,y);//mのトレース
	}
	ctx.stroke();
	ctx.strokeStyle ="black";
	}

//++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++

// chk_textout の処理　************************************************************************
// 膜電位のテキスト出力
 if (chk_textout == true){
	document.write("Temp "+String(celsius)+"&deg;"+"C"+"<br/>");
	document.write("Stim1 "+String(Camplitude1)+"&micro;"+"A"+","+String(Cduration1)+"ms"+"<br/>");
	if (Stim_Num == 2){
		document.write("Delay"+String(Interval)+"ms"+"<br/>");
		document.write("Stim2 "+String(Camplitude2)+"&micro;"+"A"+","+String(Cduration2)+"ms"+"<br/>");
	}
	document.write("<br/>");
	document.write("T(ms)");
	if(chk_V == true){document.write(","+"V(mV)");}
	if(chk_GNa == true){document.write(","+"GNa(mS)");}
	if(chk_GK == true){document.write(","+"GK(mS)");}
	if(chk_m == true){document.write(","+"m");}
	if(chk_n == true){document.write(","+"n");}
	if(chk_h == true){document.write(","+"h");}
	document.write("<br/>");

	for(i=0;i<(tstop/dt+1);i=i+4){  //
		document.write(Math.round(dt*i*10000)/10000);
		if(chk_V == true){document.write(","+Math.round((Vrest+V[i])*100)/100);}
		if(chk_GNa == true){document.write(","+Math.round((Gmna[i])*100)/100);}
		if(chk_GK == true){document.write(","+Math.round((Gmk[i])*100)/100);}
		if(chk_m == true){document.write(","+Math.round((m1[i])*100)/100);}
		if(chk_n == true){document.write(","+Math.round((n1[i])*100)/100);}
		if(chk_h == true){document.write(","+Math.round((h1[i])*100)/100);}
		document.write("<br/>");
	}
 }


//**********************************************************************

}
//**********************************************************************
// -->
</script>
<font size="1"><p><pre>   <a href="AP_instruction_guide.pdf" target="_blank">short instruction guide</a></pre></p></font>
</form>
<div id="output"></div>
</head></html>
